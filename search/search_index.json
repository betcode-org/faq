{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Frequently Asked Questions for the betcode open-source betting software and community.</p> <p>The growing and vibrant betcode ecosystem offers tools and community support for developers and bettors who want to automate their betting strategies. Our github repositories offer open-source tools for consuming the APIs at the Betfair and BetConnect betting exchanges, and the Flumine trading framework that greatly simplifies the running of betting strategies.</p> <p>Support for using these tools and strategy development in general is available from experienced (and profitable) sports bettors on our Slack channel.</p> <p>Here you will find our FAQ that brings together many of the questions asked most frequently on that channel.</p>"},{"location":"deploying-strategies/","title":"Deploying Strategies","text":""},{"location":"deploying-strategies/#new-strategies","title":"New Strategies","text":"I\u2019m about to run a new strategy live. What should I do to protect myself in case it goes horribly wrong? <p>Before running a new strategy live, it is recommended that you paper trade for a short period. Assuming you have backtested properly, it should work with similar results. However, it's a good way to uncover any environmental differences.</p> <p>When you're ready to trade with real money, you may want to protect yourself by limiting the amount of funds in your account. One way to do this without actually withdrawing funds from Betfair, is to temporarily transfer any surplus from the account's \"Main Wallet\" to the \"Exchange Games Wallet\" where it can be parked until you are confident that the new strategy won't run rampant.</p> Is there a way to force my strategy to process market books periodically, even when there\u2019s no update within that period? <p>There is. You can set the streaming_timeout parameter for your strategy and it will force an update after the specified number of seconds.</p> What is conflate_ms used for when creating a strategy? <p>By default Betfair\u2019s matching engine runs every 50 milliseconds and streams updates to subscribed channels. However, if you don\u2019t want to receive them that frequently, you can set this parameter to a higher value. You might wish to do this if, for example, your strategy isn\u2019t particularly time-sensitive, but each update requires substantial processing, or because your stratey is callibrated to a longer timeframe.</p> I am about to put my new strategy live - how will I add new markets to the stream when they're opened? <p>You can't. Instead, when defining your market filter, don't list specific markets, just describe the sort of markets you want to stream. Event types, market types and countries are good for this. Then when Betfair adds new markets to the exchange it will automatically add them to your stream if they satisfy your filters.</p>"},{"location":"deploying-strategies/#resources","title":"Resources","text":"Should I run a separate instance of Flumine for each of my strategies? <p>Usually no. Flumine is capable of automatically merging the streams needs for multiple strategies into a single subscription and then delivering the market updates needed for each strategy to those strategies alone. This makes the streaming more efficient.</p> <p>Exceptions to this would be where the strategies are in different sports, or would result in subscribing to more markets that your Betfair subscription limit.</p> Has anyone tried streaming using AWS Lambda or any other serverless service? And any recommendations on the same? <p>Don't do it. Serverless is priced per invocation of the code and you'll have a huge number of them. It's straightforward and much more cost effective to spin up a dedicated EC2 instance or VPS and run your code on there.</p>"},{"location":"deploying-strategies/#problems","title":"Problems","text":"I\u2019m getting lots of log messages about latency. What do they mean and what should I do? <p>When a Flumine strategy receives a market book update, it compares the updates timestamp to the clock where you are processing it. If there's a significant difference, usually a delay, it logs a warning message,</p> <p>There are several possible causes:</p> <ul> <li>Your clock may be out of sync with real-time. We recommend that you ensure that it is regularly synchronised to an atomic clock to avoid this issue.</li> <li>There may be a network delay such as a traffic spike at your ISP, or a family member streaming a Netflix movie, causing a slowing down the rate at which updates are getting to you - these are usually temporary and typically clear themselves.</li> <li>Sometimes it will be because your processing of each update is too complex or inefficient and isn't completing before the next one arrives. This is likely to be the case if the latency duration is climbing. In which case you will need to profile your code to identify and deal with the processing bottleneck.</li> </ul>"},{"location":"developing-and-testing-strategies/","title":"Developing and Testing Strategies","text":""},{"location":"developing-and-testing-strategies/#finding-strategies","title":"Finding Strategies","text":"What would be a profitable strategy for horse racing? <p>We will answer almost anything else about how to automate your betting, find strategies, and assess their profit potential. But we won't give you profitable strategies.</p> <p>There's a good reason for this. Many of the channel's members make their living from betting in sports markets. But those markets are very dynamic and are constantly evolving. Consequently when the details of a successful strategy become public, markets evolve to remove the inefficiency that made it profitable. So the strategy that you're given would very probably no longer be profitable by the time you've implemented it, and the person who gave it to you would have lost some of their income.</p> Can you recommend a good book to help me deepen my understading of betting markets <p>There are an awful lot of truly terrible books out there. Generally if they include \"win money daily\", \"bet profitably\" or the words \"secret\", \"easy\" or \"guaranteed\" in the title - stay well away.</p> <p>However there are also some very useful and interesting books. Though some are quite expensive, the following have been recommended by active bettors on our Slack channel:</p> <ul> <li>The Logic of Sports Betting</li> <li>Trading Bases</li> <li>Statistical Sports Models in Excel</li> <li>Precision: Statistical and Mathematical Methods in Horse Racing</li> <li>Efficiency of Racetrack Betting Markets</li> <li>The Kelly Capital Growth Investment Criterion: Theory and Practice</li> <li>A Man for All Markets: Beating the Odds, from Las Vegas to Wall Street</li> <li>Soccernomics</li> <li>The Signal and the Noise: The Art and Science of Prediction</li> <li>Precision: Statistical Mathematical Methods in Horse Racing</li> <li>Beyer on Speed: New Strategies for Racetrack Betting</li> <li>Beyond the Odds: Efficient Market Theory and Tools of Warfare for the Modern Sports Bettor</li> </ul> What\u2019s the difference between technical indicators and fundamentals and what do people here use? <p>Technical indicators are extracted from what's happening in a betting market, such as prices, trading volumes matched per runner, amounts available to back or lay, when liquidity arrives in the market, etc. fundamentals ignore what's happening in the market and focus on real world data - how well has that horse been running recently? what's that teams form like? which dog runs best when it's raining? and so on ...</p> <p>This channel has members with clear preferences for one or the other and many will use both, either for different strategies or by \"stacking\" them in the same strategy.</p> <p>In general, it's easier to work with technical indicators, but if you have a good understanding of the key factors for the sport in which you'll be betting, fundamentals may offer better opportunities.</p> Can AI/ML help with developing betting strategies? <p>Opinions here are mixed. There are members who run successful strategies with just a few \"if\" statements. On the other hand we have huge amounts of data available to us and for some that's a natural opportunity to use ML approaches leading to AI models.</p> <p>If the latter appeals to you, go for it, but with care. Sports data is very noisy and it's incredibly easy to mine opportunities that aren't real, so ensure that you know how to avoid overfitting your models and properly evaluating their accuracy.</p> Where can I find a list of all possible Betfair market types for my favourite sport? <p>Sadly there's no foolproof way to do this. Different events of the same type will typically have a core set of markets, but popular events may have others added if Betfair believes that there will be sufficient interest amongst bettors. Some of these additional markets may be quite specific and appear infrequently.</p> <p>To get an idea of the specific market types available currently for, say, Ice Hockey, you could run a small script like this:</p> <pre><code>results = trading.betting.list_market_catalogue(\n    filter=betfairlightweight.filters.market_filter(\n        event_type_ids=[\"7524\"],  # ice hockey\n    ),\n    market_projection=[\"MARKET_DESCRIPTION\"],\n    max_results=200,\n)\nprint({result.description.market_type for result in results})\n</code></pre>"},{"location":"developing-and-testing-strategies/#implementing-strategies","title":"Implementing Strategies","text":"I\u2019ve been trading manually for a while and want to automate my strategies. How do I start? <p>You will want to take advantage of the Flumine trading framework. For an easy to understand introduction to how strategies are structured in Flumine, take a look at the lowest layer strategy in the flumine examples folder.</p> When should I use middleware or a worker? <p>Middleware is run each time there's a market update immediately before that update is delivered to your strategy, so it is extra processing that will add to your strategy's execution time. Workers run on a different thread at a frequency that you set when you initiate them, so should have minimal, if any, impact on your strategy's execution.</p> <p>So if you want to change or extend the market information, for example by calculating a technical indicator from the updated market data, then you would probably want to use middelware. However, if you were periodically making calls to an external API, to obtain match statistics for example, you would most likely want to do this in parallel to your strategy execution and so would use a worker.</p> <p>One exception would be when backtesting. The simulator works by patching the system clock to the time the event was taking place, as it's rather difficult to keep patched times in sync on different processors, workers don't play nicely with backtesting and you will need to use middleware to achieve accurate results.</p> How does Flumine handle abandoned events? <p>This isn't something that Flumine handles explicitly. Rather it deals with the updates received from Betfair in exactly the same way as it would when the same updates information are received in a normal race. So the question shifts to what updates does Betfair provide for an abandoned race?</p> <p>The answer is that Betfair first suspends the affected markets, and sets all the available ladder volumes to zero, Then it removes all the runners and closes the markets. There's no explicit \"abandoned\" status or reason given for closing each market.</p> <p>It will also cancel all the orders on the affected markets, which Flumine will detect in the order stream if you have that running (i.e. haven't overriden the default).</p> Why does the get_runner_context function require the runner handicap when it's always zero? <p>The get_runner_context function needs three parameters to ensure that it returns a unique context: market_id, selection_id and handicap. The handicap is not the same as the weight handicap in a horse race or distance handicap in a greyhound race. rather it is the articial handicap added to asian handicap markets (e.g. Man United to win by more than one goal). So although it is zero for most market types, for asian handicaps we need to combine the selection_id and handicap to identify a unique outcome.</p> <p>Similarly there are other market types for which we can't rely on selection_id and (zero) handicap to uniquely identify the outcome. For example, draws in all soccer have the same selection_id, so we need to add the market_id to uniquely identify the specific outcome for which we want the runner context.</p> How do I merge information from the Betfair market catalogue with the market data <p>If you're using Flumine this will happen automatically if you're using a live stream i.e. for live or paper trading. But it doesn't happen immediately, rather it can tale a minute or so before it appears. When it is available you will be able to access the catalogue object at market.market_catalogue.</p> <p>If you're backtesting then the data will be available only if you collected it at the time of the event, which is usually done using the marketrecorder. You'll then need to tell Flumine where to find the catalogue file. This is done by creating a middleware file based on the example in the Flumine repo, and then enabling it with:</p> <pre><code>framework.add_market_middleware(MarketCatalogueMiddleware())\n</code></pre> In the market blotter when I get <code>live_orders</code>, is this across all strategies? And what is considered a live order? <p>They are orders which have not been completed, voided or expired in the specific market for all strategies. Most of the time this will mean that they are 'executable' (i.e. have <code>OrderStatus.EXECUTABLE</code>), but they could be, briefly, <code>PENDING</code>, <code>CANCELLING</code>, <code>REPLACING</code> or <code>UPDATING</code> as well.</p> <p>This differs from the orders that are passed to the your strategy's <code>process_orders</code> method, which will receive all orders, irrespective of the status, but only for that specific strategy.</p> I'd like my Strategy to perform some action when it stops (either because I stop the script manually with Ctrl+C but also in case of a bug). Where should I put this code? <p>You should overwrite the finish method, this method is called before flumine ends.</p> How can I keep the state of my flumine Strategy after a restart? <p>Take a look at the Middleware orders.py. It will add execution complete orders to the blotter, so the exposures you had will be correctly loaded after a restart of the same Strategy.</p>"},{"location":"developing-and-testing-strategies/#testing-strategies","title":"Testing Strategies","text":"How do I know if my strategy will be successful? <p>Ah. if only there was an easy answer to this question. But there are some steps that you can take to be confident that it will be, or to avoid losing money if it won't.</p> <p>Every new strategy should be extensively backtested. This means running it against historical data. Flumine can make this easy for you as it's usually possible to code a strategy as it will be if you take it live and instead pass it a list of historical markets for which you have data to run it against those instead and then evaluate the results.</p> <p>To evaluate the results you would look at two things. Did it generate profits and did you have an adequate sample size to have confidence in those profits. Successful sports bettors may work with profits as low as 1-3% return on investment after commission has been deducted. There will be winning streaks and losing streaks, but provided you have a large enough sample these will even out over time. A typical sample size should certainly cover multiple months and for sports such as racing and soccer, thousands of markets.</p> How do I compare each-way prices with win and place markets when backtesting in Flumine? <p>When backtesting strategies, Flumine by default streams each market in turn delivering the price updates for that market before moving on to the next one. This is different to what would happen when running live when updates are received for all markets in time order.</p> <p>The real-world situation can be partially replicated however by activating event processing. This will merge the updates for a given event and deliver them in the order that they originally occurred. It can be enabled as follows:</p> <pre><code>strategy = ExampleStrategy(\n    market_filter={\"markets\": [..], \"event_processing\": True}\n)\n</code></pre> <p>Each market in an event is then made available to the others e.g.</p> <p><code>win_market = market.event[\"WIN\"][0]</code> (a list of market objects of the requested type is returned)</p> <p>This will also work for other sports when an event has multiple markets, however, sadly, it won't work for the forecast market in greyhound races or for markets that are added with a different event ID in other sports.</p>"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#tools","title":"Tools","text":"What are the differences between Betfairlightweight, Flumine and BetConnect? <p>Betcode-org currently supports three python packages: Betfairlightweight, BetConnect and Flumine. The Betfairlightweight and BetConnect packages are wrappers around the Betfair and Beconnect Betting Exchange APIs, allowing requests to be made to those services and responses to be handled.</p> <p>Flumine is a trading framework that sits on top of Betfairlightweight and BetConnect package. It handles a lot of the repetitive work needed to run strategies and so offers a quick, efficient and battle-tested structure for developing and executing betting strategies at those exchanges.</p> How do Flumine Strategies work? <p>There's a technical overview of the structure in the documentation, but if you are looking for a more accessible entry point, take a look at the lowest layer example in the code's examples folder.</p> <p>That example shows how, with only a few lines of code, you can filter the sports markets in which you want to trade, calculate conditions and place orders when they're met and then monitor orders and remove the ones that aren't matched.</p>"},{"location":"getting-started/#technical-terms","title":"Technical Terms","text":"What is \"Streaming\"? <p>If you want to know the current prices for an event at Betfair, you could post an API request for that information and receive back a response with that information. However, it would be out-of-date almost as soon as you receive it. So you could end up making huge numbers of requests just to stay current.</p> <p>This \"polling\" approach creates processing load for you and for Betfair's servers, so Betfair offers a much more efficient alternative, called streaming. When streaming, you first tell Betfair what types of markets you wish to follow (known as subscribing), they will send you the current state of each of those markets and then whenever there is a price change they'll automatically send (\"push\") an update to your data stream.</p> <p>As Betfair only normally sends changes, there is a lot less data needing to be sent. better still, as new markets are opened matching your original subscription, Betfair will automatically start to include these too in the data that it sends you.</p> <p>Betfairlightweight can manage subscriptions and updates to your stream and either pass them to you for processing directly, but it's easier to subscribe to streams and handle the responses in Flumine.</p> <p>It's also possible to stream orders, and if you use Flumine for your trading strategies, it will do this automatically for you. Streaming is not currently available for the BetConnect Exchange.</p> What are backtesting, paper trading and simulations? <p>Backtesting is a key step in betting strategy development. It means taking a strategy that you think may be profitable and seeing what the results would be if you were to run it against historical data.</p> <p>Paper testing is another way of testing a strategy whereby instead of placing real bets, you record the bets your strategy would have made live and then see what what the results would have been once the event has finished. Historically you would have written the details of the bets you would have placed, hence the name.</p> <p>As in both cases no bets are actually placed, we have to work out what the results would have been. Flumine can do this for us by simulating the market and assessing whether the bet would have been matched and then evaluating the resulting profit (or loss) when the market closed. So backtesting and paper trading through Flumine are both examples of simulations.</p> <p>It is important to note that the Flumine simulation engine has some real-world limitations. It can't anticipate the effect that placing bets will have on the market itself. So for example, placing a very large bet in real-life will often change how other bettors act, e.g. change prices, in ways that the simulator can't anticipate. </p>"},{"location":"getting-started/#services","title":"Services","text":"What cloud services do people here use for running bots and storing data? <p>Although some use Google Cloud, the majority of active users of this channel seem to prefer AWS. So S3 is the preferred choice for storing historic data and EC2 instances for running bots however all packages are cloud agnostic and can run locally just as well.</p> <p>In addition, some use AWS Lambda for data ingestion and cleansing, and a variety of databases are used for storing meta data or real-time data.</p> I have a question that's not addressed here. From where can I get further help? <p>If you haven't already, it's certainly worth diving into the more advanced topics in the documentation.</p> <p>If you still have questions, then the betcode community hangs out on Slack.</p>"},{"location":"using-data/","title":"Using Data","text":""},{"location":"using-data/#betfair-data","title":"Betfair Data","text":"I\u2019m starting to use the API to collect data. Do I need to place bets? <p>The short answer is yes. But how many? We don't know.</p> <p>The key principle is that Betfair allows you access to their data for your personal betting activities, but they sell it to other users. So they want to be sure that you're not collecting it for commercial use. Show them some betting activity as evidence that you're using it only for your personal use and you'll be OK.</p> How do I filter streams by competition? <p>Sadly, you can't. When using Flumine the best approach is to include a condition in your strategy's <code>check_market_book</code> method to discard the competitions that you're not interested in.</p> <p>Betfair are aware of this limitation, but apparently it's a lot of work to remove.</p> How do I match runner names to runner IDs? <p>Betfair market books allow you to see the prices ladder for each runner ID (selection_id) but not the name. The names for each runner can be found in the market catalogue.</p> <p>When running a live strategy, Flumine will automatically inject the market catalogue into your data in <code>market.market_catalogue</code>, but when backtesting it's only available if you recorded it at the time. If you did, then you can inject it into your testing results using the market catalogue middleware.</p> How can I get the last traded price before a match starts without recording the whole market? <p>A rough and ready way would be to use Betfairlightweight to place an API call at the scheduled market time and use the last traded price at that point. However, if you're streaming market data in Flumine, there's very little overhead to storing last traded prices in the strategy's \"context\" dictionary <code>strategy.context</code> and overwriting them each time they market update changes them until the market goes \"inplay\". This would be the recommended approach in most situations.</p> The market start times don\u2019t seem to match when events actually start in my country. Why is this? <p>Betfair datetimes are always for UTC timezone. You will need to translate them to your local timezone.</p> How do I get the trap number for greyhounds in Betfair? <p>The trap number is always the first character (and very, very rarely, first two characters) of the runner name. So if <code>Droopys Child</code> is running in trap 3, the selection name in the market catalogue will be <code>3. Droopys Child</code>. If that dog is a non-runner, then for UK greyhounds it might be replaced by <code>3. Flopsy Bunny (res)</code>. for Australian greyhounds the replacement might be <code>9. Flopsy Bunny</code>, with sort priority 3.</p> I see that I can download or buy historical data from Betfair. Is it worth it? <p>Betfair historical data comes in three flavours: basic, advanced and pro. The specification for each package is available here. Basic data is free but generally of little value as it contains the last traded price at minute intervals and little else. Advanced offers data on best prices and volumes, but with a 1 second frequency only. Pro data is intended to provide the same content and granularity as if you were streaming it yourself.</p> <p>The channel's most common recommendation is to stream and collect it yourself. If you have time constraints or deep pockets, the most common recommendation is not use only the Pro version unless and exceptionally your intended strategy will be specifically geared to the lower frequency of the Advanced data.</p> <p>If you are considering purchasing data, do checkout what free advanced and pro data Betfair might have available at the time.</p> Where can I get historical Betfair starting prices? <p>Historic BSPs are only available for horse and greyhound racing and can be found on the Betfair prices page, though the data is sometimes incomplete.</p>"},{"location":"using-data/#third-party-data","title":"Third Party Data","text":"Where can I get historic starting prices for football matches? <p>Until recently, Betfair didn't have starting prices for football (soccer) matches. It is currently rolling them out to a limited number of top level matches, but the starting prices still aren't published after the event, and may never be. Alternatives are bookmaker starting prices and Betfair pre-match closing prices.</p> <p>Bookmaker starting prices (aka market closing prices) for major leagues are available for free from football-data.co.uk and a host of paid-for services.</p> <p>Betfair pre-match closing prices can be recorded by streaming markets, saving the current prices to the market.context dcitionnary and overwriting the values each time there's an update, until the market goes in-play.</p> I\u2019ve been using a third-party soccer feed, but the team names don\u2019t always match with Betfair's. How do other people handle this? <p>There's no easy answer to this. Many people build and maintain mappings between the data provided by different providers.</p> <p>These mappings may be created manually or programmatically by using a combination of event matching and fuzzy text matching. So for example, by matching all soccer teams in the same league, or all the horses in the same race, you will usually be left with only a very small number that don't match easily. Although not a direct answer to your question, you may also find these Betfair mappings helpful.</p>"}]}